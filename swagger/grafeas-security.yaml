---
swagger: '2.0'
info:
  title: v1alpha1/proto/grafeas.proto
  version: version not set
schemes:
  - http
  - https
consumes:
  - application/json
produces:
  - application/json
paths:
  /v1alpha1/projects:
    get:
      summary: Lists `Projects`
      operationId: ListProjects
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/apiListProjectsResponse'
      parameters:
        - name: filter
          description: The filter expression.
          in: query
          required: false
          type: string
        - name: page_size
          description: Number of projects to return in the list.
          in: query
          required: false
          type: integer
          format: int32
        - name: page_token
          description: Token to provide to skip to a particular spot in the list.
          in: query
          required: false
          type: string
      tags:
        - GrafeasProjects
    post:
      summary: Creates a new `Project`.
      operationId: CreateProject
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/apiEmpty'
      parameters:
        - name: body
          in: body
          required: true
          schema:
            $ref: '#/definitions/apiProject'
      tags:
        - GrafeasProjects
  /v1alpha1/projects/{projectId}:
    get:
      summary: Returns the requested `Project`.
      operationId: GetProject
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/apiProject'
      parameters:
        - name: projectId
          in: path
          description: "Part of `parent`. This field contains the projectId for example: projects/{projectId}"
          required: true
          type: string
      tags:
        - GrafeasProjects
    put:
      summary: Updates an existing `Project`.
      operationId: UpdateProject
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/apiProject'
      parameters:
        - name: projectId
          in: path
          description: "Part of `parent`. This field contains the projectId for example: projects/{projectId}"
          required: true
          type: string
        - name: body
          in: body
          required: true
          schema:
            $ref: '#/definitions/apiProject'
      tags:
        - GrafeasProjects
    delete:
      summary: Deletes the given `Project` from the system.
      operationId: DeleteProject
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/apiEmpty'
      parameters:
        - name: projectId
          in: path
          description: "Part of `parent`. This field contains the projectId for example: projects/{projectId}"
          required: true
          type: string
      tags:
        - GrafeasProjects


  /v1alpha1/projects/{projectId}/notes:
    get:
      summary: Lists all `Notes` for a given project.
      operationId: ListNotes
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/apiListNotesResponse'
      parameters:
        - name: projectId
          in: path
          description: "Part of `parent`. This field contains the projectId for example: projects/{projectId}"
          required: true
          type: string
        - name: filter
          description: The filter expression.
          in: query
          required: false
          type: string
        - name: page_size
          description: Number of notes to return in the list.
          in: query
          required: false
          type: integer
          format: int32
        - name: page_token
          description: Token to provide to skip to a particular spot in the list.
          in: query
          required: false
          type: string
      tags:
        - GrafeasNotes
    post:
      summary: Creates a new `Note`.
      operationId: CreateNote
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/apiNote'
      parameters:
        - name: projectId
          in: path
          description: "Part of `parent`. This field contains the projectId for example: projects/{projectId}"
          required: true
          type: string
        - name: body
          in: body
          required: true
          schema:
            $ref: '#/definitions/apiNote'
      tags:
        - GrafeasNotes
  /v1alpha1/projects/{projectId}/notes/{noteId}:
    get:
      summary: Returns the requested `Note`.
      operationId: GetNote
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/apiNote'
      parameters:
        - name: projectId
          in: path
          description: "First part of note `name`: projects/{projectId}/notes/{noteId}"
          required: true
          type: string
        - name: noteId
          in: path
          description: "Second part of note `name`: projects/{projectId}/notes/{noteId}"
          required: true
          type: string
      tags:
        - GrafeasNotes
    put:
      summary: Updates an existing `Note`.
      operationId: UpdateNote
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/apiNote'
      parameters:
        - name: projectId
          in: path
          description: "First part of note `name`: projects/{projectId}/notes/{noteId}"
          required: true
          type: string
        - name: noteId
          in: path
          description: "Second part of note `name`: projects/{projectId}/notes/{noteId}"
          required: true
          type: string
        - name: body
          in: body
          required: true
          schema:
            $ref: '#/definitions/apiNote'
      tags:
        - GrafeasNotes
    delete:
      summary: Deletes the given `Note` from the system.
      operationId: DeleteNote
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/apiEmpty'
      parameters:
        - name: projectId
          in: path
          description: "First part of note `name`: projects/{projectId}/notes/{noteId}"
          required: true
          type: string
        - name: noteId
          in: path
          description: "Second part of note `name`: projects/{projectId}/notes/{noteId}"
          required: true
          type: string
      tags:
        - GrafeasNotes

  /v1alpha1/projects/{projectId}/occurrences/{occurrenceId}/notes:
    get:
      summary: Gets the `Note` attached to the given `Occurrence`.
      operationId: GetOccurrenceNote
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/apiNote'
      parameters:
        - name: projectId
          in: path
          description: "First part of occurrence `name`: projects/{projectId}/occurrences/{occurrenceId}"
          required: true
          type: string
        - name: occurrenceId
          in: path
          description: "Second part of occurrence `name`: projects/{projectId}/occurrences/{occurrenceId}"
          required: true
          type: "string"
      tags:
        - GrafeasNotes

  /v1alpha1/projects/{projectId}/occurrences:
    get:
      summary: Lists active `Occurrences` for a given project matching the filters.
      operationId: ListOccurrences
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/apiListOccurrencesResponse'
      parameters:
        - name: projectId
          in: path
          description: "Part of `parent`. This contains the projectId for example: projects/{projectId}"
          required: true
          type: string
        - name: filter
          description: The filter expression.
          in: query
          required: false
          type: string
        - name: page_size
          description: Number of occurrences to return in the list.
          in: query
          required: false
          type: integer
          format: int32
        - name: page_token
          description: Token to provide to skip to a particular spot in the list.
          in: query
          required: false
          type: string
      tags:
        - GrafeasOccurrences
    post:
      summary: |-
        Creates a new `Occurrence`. Use this method to create `Occurrences`
        for a resource.
      operationId: CreateOccurrence
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/apiOccurrence'
      parameters:
        - name: projectId
          in: path
          description: "Part of `parent`. This contains the projectId for example: projects/{projectId}"
          required: true
          type: string
        - name: body
          in: body
          required: true
          schema:
            $ref: '#/definitions/apiOccurrence'
      tags:
        - GrafeasOccurrences

  /v1alpha1/projects/{projectId}/notes/{noteId}/occurrences:
    get:
      summary: |-
        Lists `Occurrences` referencing the specified `Note`. Use this method to
        get all occurrences referencing your `Note` across all your customer
        projects.
      operationId: ListNoteOccurrences
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/apiListNoteOccurrencesResponse'
      parameters:
        - name: projectId
          in: path
          description: "First part of note `name`: projects/{projectId}/notes/{noteId}"
          required: true
          type: string
        - name: noteId
          in: path
          description: "Second part of note `name`: projects/{projectId}/notes/{noteId}"
          required: true
          type: string
        - name: filter
          description: The filter expression.
          in: query
          required: false
          type: string
        - name: page_size
          description: Number of notes to return in the list.
          in: query
          required: false
          type: integer
          format: int32
        - name: page_token
          description: Token to provide to skip to a particular spot in the list.
          in: query
          required: false
          type: string
      tags:
        - GrafeasOccurrences

definitions:
  apiCertainty:
    type: string
    enum:
      - CERTAINTY_UNSPECIFIED
      - LOW
      - MEDIUM
      - HIGH
    default: CERTAINTY_UNSPECIFIED
    description: |-
      Note provider-assigned confidence on the validity of an occurrence
      - CONFIDENCE_UNSPECIFIED&#58; Unknown Certainty
      - LOW&#58; Low Certainty
      - MEDIUM&#58; Medium Certainty
      - HIGH&#58; High Certainty

  apiEmpty:
    type: object
    description: |-
      A generic empty message that you can re-use to avoid defining duplicated
      empty messages in your APIs. A typical example is to use it as the request
      or the response type of an API method.
      The JSON representation for `Empty` is empty JSON object `{}`.

  apiListNoteOccurrencesResponse:
    type: object
    properties:
      occurrences:
        type: array
        items:
          $ref: '#/definitions/apiOccurrence'
        description: The occurrences attached to the specified note.
      next_page_token:
        type: string
        description: Token to receive the next page of notes.
    description: Response including listed occurrences for a note.

  apiListNotesResponse:
    type: object
    properties:
      notes:
        type: array
        items:
          $ref: '#/definitions/apiNote'
        title: The occurrences requested
      next_page_token:
        type: string
        description: |-
          The next pagination token in the list response. It should be used as
          page_token for the following request. An empty value means no more result.
    description: Response including listed notes.

  apiListOccurrencesResponse:
    type: object
    properties:
      occurrences:
        type: array
        items:
          $ref: '#/definitions/apiOccurrence'
        description: The occurrences requested.
      next_page_token:
        type: string
        description: |-
          The next pagination token in the list response. It should be used as
          `page_token` for the following request. An empty value means no more
          results.
    description: Response including listed active occurrences.

  apiListProjectsResponse:
    type: object
    properties:
      projects:
        type: array
        items:
          $ref: '#/definitions/apiProject'
        description: The projects requested.
      next_page_token:
        type: string
        description: |-
          The next pagination token in the list response. It should be used as
          `page_token` for the following request. An empty value means no more
          results.
    description: Response including listed projects

  apiNote:
    type: object
    properties:
      name:
        type: string
        title: |-
          The name of the note in the form "projects/{projectId}/notes/{noteId}"
      short_description:
        type: string
        description: A one sentence description of this `Note`.
      long_description:
        type: string
        description: A detailed description of this `Note`.
      kind:
        $ref: '#/definitions/apiNoteKind'
        description: |-
          Output only. This explicitly denotes which kind of note is specified. This
          field can be used as a filter in list requests.
      related_url:
        type: array
        items:
          $ref: '#/definitions/apiNoteRelatedUrl'
        title: URLs associated with this note
      expiration_time:
        type: string
        format: date-time
        description: 'Time of expiration for this note, null if note does not expire.'
      create_time:
        type: string
        format: date-time
        description: |-
          Output only. The time this note was created.
          This field can be used as a filter in list requests.
      update_time:
        type: string
        format: date-time
        description: |-
          Output only. The time this note was last updated.
          This field can be used as a filter in list requests.
      vulnerability_type:
        $ref: '#/definitions/VulnerabilityType'
        description: A package vulnerability type of note.

      #
      # IBM extensions start here
      #
      security_finding_type:
        $ref: '#/definitions/SecurityFindingType'
        description: A security finding type of note.
      #
      # IBM extensions stop here
      #
    description: Provides a detailed description of a `Note`.

  apiNoteKind:
    type: string
    enum:
      - KIND_UNSPECIFIED
      - PACKAGE_VULNERABILITY
      - SECURITY_FINDING
    default: KIND_UNSPECIFIED
    description: |-
      This must be 1&#58;1 with members of our oneofs, it can be used for filtering
      Note and Occurrence on their kind.
       - KIND_UNSPECIFIED&#58; Unknown
       - PACKAGE_VULNERABILITY&#58; The note and occurrence represent a package vulnerability.
       - SECURITY_FINDING&#58; The note and occurrence represent a security finding.

  apiNoteRelatedUrl:
    type: object
    properties:
      url:
        type: string
        title: Specific URL to associate with the note
      label:
        type: string
        title: Label to describe usage of the URL
    description: Metadata for any related URL information

  apiOccurrence:
    type: object
    properties:
      name:
        type: string
        description: |-
          Output only. The name of the `Occurrence` in the form "projects/{projectId}/occurrences/{occuurenceId}"
      resource_url:
        type: string
        description: |-
          The unique URL of the resource, image or the container, for which the `Occurrence` applies.
          For example, https://gcr.io/project/image@sha256:foo.
          This field can be used as a filter in list requests.
      note_name:
        type: string
        description: |-
          An analysis note associated with this image, in the form "projects/{projectId}/notes/{noteId}"
          This field can be used as a filter in list requests.
      kind:
        $ref: '#/definitions/apiNoteKind'
        description: |-
          Output only. This explicitly denotes which of the `Occurrence` details are specified.
          This field can be used as a filter in list requests.
      remediation:
        type: string
        title: A description of actions that can be taken to remedy the `Note`
      create_time:
        type: string
        format: date-time
        description: Output only. The time this `Occurrence` was created.
      update_time:
        type: string
        format: date-time
        description: Output only. The time this `Occurrence` was last updated.
      vulnerability_details:
        $ref: '#/definitions/VulnerabilityTypeVulnerabilityDetails'
        description: Details of the occurrence of a security vulnerability.

      #
      # IBM extensions start here
      #
      short_description:
        type: string
        description: A one sentence description of this `Occurrence`.
      long_description:
        type: string
        description: A detailed description of this `Occurrence`.
      resource_details:
        $ref: '#/definitions/apiResourceDetails'
        description: Details about the resource this `Occurrence` applies to
      severity:
        $ref: '#/definitions/apiSeverity'
        description: The common severity of this `Occurrence`
      certainty:
        $ref: '#/definitions/apiCertainty'
        description: The confidence level on this `Occurrence`
      security_finding_details:
        $ref: '#/definitions/SecurityFinding'
        description: Details of the occurrence of a security finding.
      #
      # IBM extensions stop here
      #
    description: '`Occurrence` includes information about analysis occurrences for an image.'

  apiProject:
    type: object
    properties:
      name:
        type: string
        title: The name of the project of the form "projects/{projectId}"
    description: Provides detailed description of a `Project`.

  apiResourceDetails:
    type: object
    properties:
      source_url:
        type: string
        description: The unique url of the source (e.g. service, app) of the occurrence
      region:
        type: string
        description: The region the resource belongs to
      account:
        type: string
        description: The account the resource belongs to
      environment_name:
        type: string
        description: The name of the logical environment the resource is linked to
      component_name:
        type: string
        description: The name of the logical component the resource is linked to
      toolchain_url:
        type: string
        description: The url of the toolchain the resource is linked to

  apiSeverity:
    type: string
    enum:
      - SEVERITY_UNSPECIFIED
      - LOW
      - MEDIUM
      - HIGH
    default: SEVERITY_UNSPECIFIED
    description: |-
      Note provider-assigned severity/impact ranking
      - SEVERITY_UNSPECIFIED&#58; Unknown Impact
      - LOW&#58; Low Impact
      - MEDIUM&#58; Medium Impact
      - HIGH&#58; High Impact

#
# Security Finding note and occurrence definitions
#
  SecurityFindingType:
    type: object
    #
    # Security Advisor team to define properties
    #
    description: SecurityFindingType provides details about a security finding note.

  SecurityFinding:
    type: object
    #
    # Security Advisor team to define properties
    #
    description: SecurityFinding provides details about a security finding occurrence.

#
# Vulnerability note and occurrence definitions
#
  VulnerabilityType:
    type: object
    properties:
      cvss_score:
        type: number
        format: float
        description: The CVSS score for this Vulnerability.
      severity:
        $ref: '#/definitions/VulnerabilityTypeSeverity'
        title: Note provider assigned impact of the vulnerability
      details:
        type: array
        items:
          $ref: '#/definitions/VulnerabilityTypeDetail'
        description: |-
          All information about the package to specifically identify this
          vulnerability. One entry per (version range and cpe_uri) the
          package vulnerability has manifested in.
    description: VulnerabilityType provides metadata about a security vulnerability.

  VersionVersionKind:
    type: string
    enum:
      - NORMAL
      - MINIMUM
      - MAXIMUM
    default: NORMAL
    description: |-
      Whether this is an ordinary package version or a
      sentinel MIN/MAX version.
       - NORMAL&#58; A standard package version, defined by the other fields.
       - MINIMUM&#58; A special version representing negative infinity,
      other fields are ignored.
       - MAXIMUM&#58; A special version representing positive infinity,
      other fields are ignored.

  VulnerabilityTypeDetail:
    type: object
    properties:
      cpe_uri:
        type: string
        description: |-
          The cpe_uri in [cpe format] (https&#58;//cpe.mitre.org/specification/) in
          which the vulnerability manifests. Examples include distro or storage
          location for vulnerable jar.
          This field can be used as a filter in list requests.
      package:
        type: string
        description: |-
          The name of the package where the vulnerability was found.
          This field can be used as a filter in list requests.
      min_affected_version:
        $ref: '#/definitions/VulnerabilityTypeVersion'
        description: The min version of the package in which the vulnerability exists.
      max_affected_version:
        $ref: '#/definitions/VulnerabilityTypeVersion'
        description: |-
          The max version of the package in which the vulnerability exists.
          This field can be used as a filter in list requests.
      severity_name:
        type: string
        description: 'The severity (eg: distro assigned severity) for this vulnerability.'
      description:
        type: string
        description: A vendor-specific description of this note.
      fixed_location:
        $ref: '#/definitions/VulnerabilityTypeVulnerabilityLocation'
        description: The fix for this specific package version.
      package_type:
        type: string
        title: |-
          The type of package; whether native or non native(ruby gems,
          node.js packages etc)
    description: |-
      Identifies all occurrences of this vulnerability in the package for a
      specific distro/location
      For example&#58; glibc in cpe&#58;/o&#58;debian&#58;debian_linux&#58;8 for versions 2.1 - 2.2

  VulnerabilityTypePackageIssue:
    type: object
    properties:
      affected_location:
        $ref: '#/definitions/VulnerabilityTypeVulnerabilityLocation'
        description: The location of the vulnerability.
      fixed_location:
        $ref: '#/definitions/VulnerabilityTypeVulnerabilityLocation'
        description: The location of the available fix for vulnerability.
      severity_name:
        type: string
        description: 'The severity (eg: distro assigned severity) for this vulnerability.'
    description: |-
      This message wraps a location affected by a vulnerability and its
      associated fix (if one is available).

  VulnerabilityTypeSeverity:
    type: string
    enum:
      - SEVERITY_UNSPECIFIED
      - MINIMAL
      - LOW
      - MEDIUM
      - HIGH
      - CRITICAL
    default: SEVERITY_UNSPECIFIED
    description: |-
      Note provider-assigned severity/impact ranking
      - SEVERITY_UNSPECIFIED&#58; Unknown Impact
      - MINIMAL&#58; Minimal Impact
      - LOW&#58; Low Impact
      - MEDIUM&#58; Medium Impact
      - HIGH&#58; High Impact
      - CRITICAL&#58; Critical Impact

  VulnerabilityTypeVersion:
    type: object
    properties:
      epoch:
        type: integer
        format: int32
        description: Used to correct mistakes in the version numbering scheme.
      name:
        type: string
        description: The main part of the version name.
      revision:
        type: string
        description: The iteration of the package build from the above version.
      kind:
        $ref: '#/definitions/VersionVersionKind'
        description: |-
          Distinguish between sentinel MIN/MAX versions and normal versions.
          If kind is not NORMAL, then the other fields are ignored.
    description: |-
      Version contains structured information about the version of the package.
      For a discussion of this in Debian/Ubuntu&#58;
      http&#58;//serverfault.com/questions/604541/debian-packages-version-convention
      For a discussion of this in Redhat/Fedora/Centos&#58;
      http&#58;//blog.jasonantman.com/2014/07/how-yum-and-rpm-compare-versions/

  VulnerabilityTypeVulnerabilityDetails:
    type: object
    properties:
      type:
        type: string
        title: |-
          The type of package; whether native or non native(ruby gems,
          node.js packages etc)
      severity:
        $ref: '#/definitions/VulnerabilityTypeSeverity'
        description: Output only. The note provider assigned Severity of the vulnerability.
      cvss_score:
        type: number
        format: float
        description: |-
          Output only. The CVSS score of this vulnerability. CVSS score is on a
          scale of 0-10 where 0 indicates low severity and 10 indicates high
          severity.
      package_issue:
        type: array
        items:
          $ref: '#/definitions/VulnerabilityTypePackageIssue'
        description: |-
          The set of affected locations and their fixes (if available) within
          the associated resource.
    description: |-
      Used by Occurrence to point to where the vulnerability exists and how
      to fix it.

  VulnerabilityTypeVulnerabilityLocation:
    type: object
    properties:
      cpe_uri:
        type: string
        description: |-
          The cpe_uri in [cpe format] (https&#58;//cpe.mitre.org/specification/)
          format. Examples include distro or storage location for vulnerable jar.
          This field can be used as a filter in list requests.
      package:
        type: string
        description: The package being described.
      version:
        $ref: '#/definitions/VulnerabilityTypeVersion'
        description: |-
          The version of the package being described.
          This field can be used as a filter in list requests.
    description: The location of the vulnerability
